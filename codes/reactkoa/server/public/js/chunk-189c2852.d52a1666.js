(window["webpackJsonpdocs"]=window["webpackJsonpdocs"]||[]).push([["chunk-189c2852"],{1141:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"layout-base"},[n("layout-base",{attrs:{title:e.title,crumbs:e.crumbs}},[n("div",[n("a-card",{attrs:{bordered:!1}},[n("div",{staticClass:"form-title",attrs:{slot:"title"},slot:"title"},[n("a-button",{staticStyle:{float:"left"},on:{click:function(t){return e.$router.push("/docs/news/list/"+e.lang)}}},[e._v(" 返回 ")]),e.isEdit?n("a-button",{staticStyle:{float:"right"},attrs:{type:"danger"},on:{click:e.handleDelete}},[e._v(" 删除 ")]):e._e(),n("a-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.handlePutIt}},[e._v(" 发布 ")]),n("a-button",{staticStyle:{float:"right"},attrs:{ghost:"",type:"primary",loading:e.previewLoading},on:{click:e.handlePreview}},[e._v(" 预览 ")]),n("a-button",{staticStyle:{float:"right"},attrs:{loading:e.saveLoading},on:{click:e.handleSave}},[e._v(" 保存 ")])],1),n("div",{staticClass:"steps-wrapper"},[n("a-steps",{attrs:{current:e.stepsData.current},on:{change:e.onStepsChange}},e._l(e.stepsData.steps,(function(e){return n("a-step",{key:e.title,attrs:{title:e.title}})})),1)],1),n("div",{staticClass:"steps-content"},[n("div",{directives:[{name:"show",rawName:"v-show",value:"edit-content"===e.stepsData.steps[e.stepsData.current].content,expression:"stepsData.steps[stepsData.current].content === 'edit-content'"}],staticClass:"content-box edit-content"},[n("a-form",{staticClass:"form",attrs:{"label-col":{span:5},"wrapper-col":{span:15}}},[n("a-form-item",{attrs:{label:"新闻标题","validate-status":e.$validate.title?"error":"",help:e.$validate.title}},[n("a-input",{attrs:{placeholder:"必填，请输入新闻标题"},on:{change:function(t){return e.initValidate("title")}},model:{value:e.viewInfo.title,callback:function(t){e.$set(e.viewInfo,"title",t)},expression:"viewInfo.title"}})],1),n("a-form-item",{attrs:{label:"发布站点"}},[n("a-input",{attrs:{placeholder:"非必填，该新闻的发布站点名称"},model:{value:e.viewInfo.psite,callback:function(t){e.$set(e.viewInfo,"psite",t)},expression:"viewInfo.psite"}})],1),n("a-form-item",{attrs:{label:"摘要","validate-status":e.$validate.remark?"error":"",help:e.$validate.remark}},[n("a-input",{attrs:{type:"textarea",placeholder:"必填，请输入新闻摘要"},on:{change:function(t){return e.initValidate("remark")}},model:{value:e.viewInfo.remark,callback:function(t){e.$set(e.viewInfo,"remark",t)},expression:"viewInfo.remark"}})],1),n("a-form-item",{attrs:{label:"选择图片"}},[n("ImgUpload",{staticClass:"set-style",staticStyle:{height:"132px"},attrs:{"default-url":e.viewInfo.posterUrl,tip:"图片尺寸：728*400，支持png、jpg、gif"},on:{change:e.handleUploadChange}})],1),n("a-form-item",{attrs:{label:"发布时间"}},[n("a-date-picker",{model:{value:e.viewInfo.ptime,callback:function(t){e.$set(e.viewInfo,"ptime",t)},expression:"viewInfo.ptime"}})],1),n("a-form-item",{attrs:{label:"站点"}},[n("a-radio-group",{attrs:{"button-style":"solid"},model:{value:e.viewInfo.isJgLink,callback:function(t){e.$set(e.viewInfo,"isJgLink",t)},expression:"viewInfo.isJgLink"}},[n("a-radio-button",{attrs:{value:1}},[e._v(" 极光本站 ")]),n("a-radio-button",{attrs:{value:0}},[e._v(" 外部链接 ")])],1)],1),n("a-form-item",{directives:[{name:"show",rawName:"v-show",value:e.viewInfo.isJgLink,expression:"viewInfo.isJgLink"}],staticStyle:{"z-index":"1"},attrs:{label:"内容"}},[n("div",{attrs:{id:"tipsEditor"}})]),n("a-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.viewInfo.isJgLink,expression:"!viewInfo.isJgLink"}],attrs:{label:"外链地址","validate-status":e.$validate.externalUrl?"error":"",help:e.$validate.externalUrl}},[n("a-input",{attrs:{placeholder:"必填，请输入外链地址"},on:{change:function(t){return e.initValidate("externalUrl")}},model:{value:e.viewInfo.externalUrl,callback:function(t){e.$set(e.viewInfo,"externalUrl",t)},expression:"viewInfo.externalUrl"}})],1)],1)],1),n("div",{directives:[{name:"show",rawName:"v-show",value:"seo-content"===e.stepsData.steps[e.stepsData.current].content,expression:"stepsData.steps[stepsData.current].content === 'seo-content'"}],staticClass:"content-box seo-content"},[n("a-form",{staticClass:"form",attrs:{"label-col":{span:5},"wrapper-col":{span:15}}},[n("a-form-item",{attrs:{label:"标题","validate-status":e.$seoValidate.title?"error":"",help:e.$seoValidate.title}},[n("a-input",{attrs:{maxLength:"en"===e.lang?80:40,placeholder:"必填，用于搜索引擎优化"},on:{change:function(t){return e.initSeoValidate("title")}},model:{value:e.seoInfo.title,callback:function(t){e.$set(e.seoInfo,"title",t)},expression:"seoInfo.title"}}),n("inputLmitTip",{attrs:{limit:"en"===e.lang?80:40,text:e.seoInfo.title}})],1),n("a-form-item",{attrs:{label:"关键字","validate-status":e.$seoValidate.keyword?"error":"",help:e.$seoValidate.keyword}},[n("a-input",{attrs:{maxLength:"en"===e.lang?80:40,placeholder:"必填，用于搜索引擎优化"},on:{change:function(t){return e.initSeoValidate("keyword")}},model:{value:e.seoInfo.keyword,callback:function(t){e.$set(e.seoInfo,"keyword",t)},expression:"seoInfo.keyword"}}),n("inputLmitTip",{attrs:{limit:"en"===e.lang?80:40,text:e.seoInfo.keyword}})],1),n("a-form-item",{attrs:{label:"描述","validate-status":e.$seoValidate.description?"error":"",help:e.$seoValidate.description}},[n("a-input",{attrs:{maxLength:"en"===e.lang?150:75,placeholder:"必填，用于搜索引擎优化"},on:{change:function(t){return e.initSeoValidate("description")}},model:{value:e.seoInfo.description,callback:function(t){e.$set(e.seoInfo,"description",t)},expression:"seoInfo.description"}}),n("inputLmitTip",{attrs:{limit:"en"===e.lang?150:75,text:e.seoInfo.description}})],1)],1)],1)]),n("a-row",{staticClass:"steps-action"},[n("a-col",{attrs:{offset:5}},[n("a-button",{directives:[{name:"show",rawName:"v-show",value:e.stepsData.current<e.stepsData.steps.length-1,expression:"stepsData.current < stepsData.steps.length - 1"}],attrs:{type:"primary"},on:{click:e.next}},[e._v(" 下一步 ")]),n("a-button",{directives:[{name:"show",rawName:"v-show",value:e.stepsData.current>0,expression:"stepsData.current > 0"}],on:{click:e.prev}},[e._v(" 上一步 ")]),n("a-button",{directives:[{name:"show",rawName:"v-show",value:e.stepsData.current===e.stepsData.steps.length-1,expression:"stepsData.current === stepsData.steps.length - 1"}],staticStyle:{"margin-left":"12px"},attrs:{type:"primary"},on:{click:e.handlePutIt}},[e._v(" 发布 ")])],1)],1)],1)],1)])],1)},i=[],o=n("5530"),r=(n("a4d3"),n("e01a"),n("a9e3"),n("d3b7"),n("159b"),n("b64b"),n("1d61")),s=n("750b"),l=n("d4ec"),c=n("bee2"),u=n("262e"),d=n("2caf"),p=(n("ac1f"),n("5319"),n("5f87")),f=n("6fad"),m=n.n(f),v=function(e){var t=Object(s["e"])({title:!1,remark:!1,externalUrl:!1}),n=Object(s["e"])({title:Object(s["a"])({get:function(){return t.title?e.title?"":"文章标题不能为空":""}}),remark:Object(s["a"])({get:function(){return t.remark?e.remark?"":"文章摘要不能为空":""}}),externalUrl:Object(s["a"])({get:function(){return e.isJgLink||!t.externalUrl||e.externalUrl?"":"外部连接不能为空"}})});function a(e){t[e]=!0}return{$validate:n,initValidate:a}},g=function(e){var t=Object(s["e"])({title:!1,keyword:!1,description:!1}),n=Object(s["e"])({title:Object(s["a"])({get:function(){return t.title?e.title?"":"标题不能为空":""}}),keyword:Object(s["a"])({get:function(){return t.keyword?e.keyword?"":"关键字不能为空":""}}),description:Object(s["a"])({get:function(){return t.description?e.description?"":"描述不能为空":""}})});function a(e){t[e]=!0}return{$seoValidate:n,initSeoValidate:a}},h=function(e){Object(u["a"])(n,e);var t=Object(d["a"])(n);function n(e){Object(l["a"])(this,n);var a=m.a.$('<div class="w-e-menu">\n        <span title="编辑源码">源码</span>\n      </div>');return t.call(this,a,e)}return Object(c["a"])(n,[{key:"clickHandler",value:function(){this.toggleActive(),this.toggleHtmlCode()}},{key:"toggleActive",value:function(){console.log(this.editor),this.isActive?this.unActive():this.active()}},{key:"toggleHtmlCode",value:function(){var e=this.editor.txt.html();e=this.isActive?e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;"):e.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&nbsp;/gi," "),this.editor.txt.html(e)}},{key:"tryChangeActive",value:function(){}}]),n}(m.a.BtnMenu),b=function(e){var t=new m.a(e),n=Object(p["a"])();return t.config.menuFixed=!1,t.config.uploadImgServer="http://devsvc-manual-api.glqa.jpushoa.com/iportal-official/picture",t.config.uploadImgAccept=["jpg","jpeg","png","gif","bmp"],t.config.uploadImgFileName="file",t.menus.extend("source",h),t.config.uploadImgHeaders={Accept:"application/json, text/plain, */*",Authorization:"sessionId="+n},t.config.uploadFileName="file",t.config.menus=["source","head","bold","fontSize","fontName","italic","underline","strikeThrough","indent","lineHeight","foreColor","emoticon","backColor","link","list","justify","quote","image","table","code","splitLine","undo"],t.config.uploadImgHooks={customInsert:function(e,t){console.log("customInsert",t),e(t.url)}},console.log(t.config),t.create(),t},w=n("4e72"),k=n("c32d"),I=n.n(k),y=n("365c"),x=n("d549"),j=n("80d4"),O={components:{LayoutBase:r["e"],ImgUpload:x["a"],inputLmitTip:j["a"]},name:"news-edit",setup:function(e,t){var n,a=t.root,i=Object(p["a"])(),r=Object(s["f"])(!!a.$route.params.id),l=Object(s["e"])({content:"",externalUrl:"",isJgLink:1,keyword:"",picUrl:"",posterUrl:"",psite:"",ptime:I()(),remark:"",title:""}),c=Object(s["e"])({title:"",keyword:"",description:""}),u=Object(s["e"])({current:0,steps:[{title:"编辑内容",content:"edit-content"},{title:"seo设置",content:"seo-content"}]}),d=Object(s["e"])({lang:"zh",title:r.value?"编辑媒体新闻":"创建媒体新闻",isSaved:r.value,id:a.$route.params.id,crumbs:[{path:"",value:"官网管理"},{path:"/docs/news/list",value:"媒体新闻"},{path:"",value:"中文"},{path:"",value:r.value?"编辑媒体新闻":"创建媒体新闻"}],originInfo:{},uploadLoading:!1,saveLoading:!1,previewLoading:!1,uploadHeaders:{Authorization:"sessionId="+i}});function f(e){l.posterUrl=e}Object(s["h"])((function(){return a.$route}),(function(e){d.lang="zh"===e.params.lang?"zh":"en",d.crumbs[1].path=d.crumbs[1].path+"/"+d.lang,"zh"===d.lang?d.crumbs[2].value="中文":d.crumbs[2].value="英文"}));var m=v(l),h=m.$validate,k=m.initValidate,x=g(c),j=x.$seoValidate,O=x.initSeoValidate;function L(){var e=Object(o["a"])(Object(o["a"])({},l),{},{seoTitle:c.title,seoKeyWords:c.keyword,seoDescription:c.description,isJgLink:!!l.isJgLink,ptime:l.ptime.format("YYYY-MM-DD"),mediaType:"NEWS"});return d.id&&"null"!==d.id&&(e.id=Number(d.id)),e.languageType="zh"===d.lang?"CHINESE":"ENGLISH",e}function S(){var e=!1;return l.content=n?n.txt.html():"",k("title"),k("remark"),k("externalUrl"),Object.keys(h).forEach((function(t){h[t]&&(e=!0)})),e?(u.current=0,!1):!(l.isJgLink&&!l.content)||(w["message"].error("新闻内容不能为空"),!1)}function $(){var e=!1;return O("title"),O("keyword"),O("description"),Object.keys(j).forEach((function(t){j[t]&&(e=!0)})),!e||(u.current=1,!1)}function D(e){for(var t=Object.keys(e),n=0;n<t.length;n++)if(e[t[n]]!==d.originInfo[t[n]])return!0;return!1}function U(){if(S()&&$()){d.saveLoading=!0;var e=L();Object(y["e"])(e).then((function(t){2e3===t.code&&t.message&&(d.id=t.message,d.originInfo=e,d.originInfo.id=Number(d.id),d.isSaved=!0,w["message"].success("保存成功"))})).finally((function(){d.saveLoading=!1}))}}function C(){if(S()&&$()){var e=L();if(!d.isSaved||D(e))return void w["Modal"].error({title:"提示",content:"请先保存后预览或发布~"});d.previewLoading=!0,Object(y["d"])(e).then((function(e){2e3==e.code&&e.message&&window.open(e.message)})).finally((function(){d.previewLoading=!1}))}}function V(){if(S()&&$()){var e=L();if(!d.isSaved||D(e))return void w["Modal"].error({title:"提示",content:"请先保存后预览或发布~"});w["Modal"].confirm({title:"提示",content:"确认发布该新闻？",onOk:function(){return Object(y["g"])({pstatus:1,id:d.id}).then((function(){w["message"].success("发布成功"),a.$router.push("/docs/news/list/"+d.lang)}))}})}}function N(){w["Modal"].confirm({title:"确认要删除这条信息吗？",content:"您确认要删除这条信息吗，删除后不可恢复",onOk:function(){return Object(y["a"])(d.id).then((function(){w["message"].success("删除成功"),a.$router.go(-1)}))}})}function T(){S()&&u.current++}function E(){u.current--}function J(e){u.current=e}return Object(s["d"])((function(){n=b("#tipsEditor"),r.value&&Object(y["b"])(d.id).then((function(e){var t;l.content=e.content,l.title=e.title,l.remark=e.remark,l.posterUrl=e.posterUrl||"",l.keyword=e.keyword||"",l.picUrl=e.picUrl||"",l.psite=e.psite||"",l.isJgLink=e.isJgLink?1:0,l.ptime=I()(e.ptime),l.externalUrl=e.externalUrl||"",c.title=e.seoTitle||"",c.keyword=e.seoKeyWords||"",c.description=e.seoDescription||"",d.lang="ENGLISH"===e.languageType?"en":"zh",d.originInfo=e,d.originInfo.mediaType="NEWS",d.originInfo.ptime=I()(e.ptime).format("YYYY-MM-DD"),d.originInfo.id=Number(d.id),d.originInfo.languageType=(null!==(t=e.languageType)&&void 0!==t?t:"zh"===d.lang)?"CHINESE":"ENGLISH",n.txt.html(e.content)}))})),Object(s["c"])((function(){n&&n.destroy(),n=null})),Object(o["a"])(Object(o["a"])({},Object(s["g"])(d)),{},{isEdit:r,viewInfo:l,$validate:h,initValidate:k,seoInfo:c,$seoValidate:j,initSeoValidate:O,handleUploadChange:f,handlePreview:C,handleSave:U,handlePutIt:V,handleDelete:N,stepsData:u,prev:E,next:T,onStepsChange:J})}},L=O,S=(n("8919"),n("2877")),$=Object(S["a"])(L,a,i,!1,null,"4fa29f29",null);t["default"]=$.exports},"365c":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"g",(function(){return o})),n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return c})),n.d(t,"f",(function(){return u}));var a=n("b775");function i(e){return Object(a["a"])({url:"official/iportal/media/news/record",params:e,method:"GET"})}function o(e){return Object(a["a"])({url:"official/iportal/media/news/change",data:e,method:"POST"})}function r(e){return Object(a["a"])({url:"official/iportal/media/news/preview",data:e,method:"POST"})}function s(e){return Object(a["a"])({url:"official/iportal/media/news/save",data:e,method:"POST"})}function l(e){return Object(a["a"])({url:"official/iportal/media/news/edit/"+e,method:"get"})}function c(e){return Object(a["a"])({url:"official/iportal/media/news/del/"+e,method:"get"})}function u(e){return Object(a["a"])({url:"official/iportal/top",data:e,method:"POST"})}},8919:function(e,t,n){"use strict";n("aafd")},aafd:function(e,t,n){}}]);
//# sourceMappingURL=chunk-189c2852.d52a1666.js.map